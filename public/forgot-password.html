<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reset Password - SkillForge</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="auth-body">

<div class="auth-wrapper">
  <div class="auth-card">

    <h2>Reset Password</h2>

    <input type="email" id="email" placeholder="Registered Email" required>
    <button class="primary-btn full-btn" onclick="sendResetOTP()">
      Send OTP
    </button>

    <div id="otpSection" style="display:none; margin-top:15px;">
      <input type="text" id="otp" placeholder="Enter OTP">
      <input type="password" id="newPassword" placeholder="New Password">
      <input type="password" id="confirmPassword" placeholder="Confirm Password">

      <button class="primary-btn full-btn" onclick="resetPassword()">
        Reset Password
      </button>
    </div>

  </div>
</div>

<script>

async function sendResetOTP() {
  const email = document.getElementById("email").value;

  const res = await fetch("http://localhost:5000/api/forgot-password/send-otp", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email })
  });

  const data = await res.json();

  if(res.ok){
    alert("OTP Sent");
    document.getElementById("otpSection").style.display="block";
  } else {
    alert(data.message);
  }
}

async function resetPassword() {
  const email = document.getElementById("email").value;
  const otp = document.getElementById("otp").value;
  const newPassword = document.getElementById("newPassword").value;
  const confirmPassword = document.getElementById("confirmPassword").value;

  if(newPassword !== confirmPassword){
    alert("Passwords do not match");
    return;
  }

  const res = await fetch("http://localhost:5000/api/forgot-password/reset", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ email, otp, newPassword })
  });

  const data = await res.json();

  if(res.ok){
    localStorage.setItem("token", data.token);
    localStorage.setItem("name", data.name);
    localStorage.setItem("email", data.email);
    window.location.href="dashboard.html";
  } else {
    alert(data.message);
  }
}

</script>

</body>
</html>